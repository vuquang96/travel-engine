(()=>{"use strict";var e={9448:(e,t,a)=>{a.d(t,{Z:()=>r});const r=()=>{const{dateFormat:e}=window.wteL10n,t={selectedPackage:null,selectedDate:e(null),selectedTime:e(null),packageCategories:{},travelerRecord:{},availablePackages:[],availableTimes:[],extraServices:{},loading:!0,defaultDateFormat:"YYYY-MM-DD",cart:{},formatPrice:function(e){const{currency:t,baseCurrency:a,currencySymbol:r,format:{number:i,price:s}}=wteL10n;let o={[a]:1};if("undefined"!=typeof wteCc&&wteCc?.code)for(let e in wteCc.code)o={...o,[wteCc.code[e]]:wteCc.rate[e]};return e*=+o[t],wteL10n.helpers.priceFormat(e,t,r,s,+i.decimal,i.decimalSeparator,i.thousandSeparator)},groupPricings:{},cartTotal:{travelers:0}};return Redux.createStore((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"SET_TRIP":return{...e,trip:a.data};case"UPDATE_STORE":return{...e,...a.data};case"SET_DATE":return{...e,selectedDate:a.date};case"SET_TIME":return{...e,selectedTime:a.data};case"SET_PACKAGE":return{...e,selectedPackage:a.data};case"SET_TRAVELER_RECORD":return{...e,travelerRecord:a.data};default:return e}}),Redux.applyMiddleware((e=>t=>a=>"function"==typeof a?a(e.dispatch,e.getState):t(a))))}}},t={};function a(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,a),s.exports}a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=a(9448).Z,t=class{constructor(t){var a;this.bookingform=t,this.summaryTemplate=wp.template("wte-booking-summary"),this.datetimeTemplate=wp.template("wte-booking-datetime"),this.extraServicesAPI=(a=this,()=>{let e=a._store,{trip:t}=e.getState();if(t.trip_extras.length<1)return;document.getElementById("wte-booking-extraservices-content").innerHTML=wp.template("wte-booking-extraservices")(),e.subscribe((()=>{let t=e.getState().services||{},a="";for(let r in t){let i=t[r],s=i?.meta.wte_services.service_type;a+=wp.template(`wte-booking-es-${s}`)({service:i,extraServices:e.getState().extraServices})}document.getElementById("wte-booking-extraservices__services").innerHTML=a,document.getElementById("wte-booking-es-summary-content").innerHTML=wp.template("wte-booking-es-summary")(e.getState())})),e.dispatch(((a,r)=>{fetch(`${wteL10n.wpapi.root}${wteL10n.wpapi.versionString}wte-services?include=${t.trip_extras?.join(",")}`).then((t=>{t.json().then((t=>{t&&e.dispatch({type:"UPDATE_STORE",data:{services:lodash.keyBy(t,"id")}})}))}))}));const r=function(t){var a,r;let i=this,s=i.closest(".wte-booking-es-counter").dataset.info;s=s&&JSON.parse(s);let{serviceID:o,option:n}=s,c={[n]:1},l=0;if(i.classList.contains("wte-up"))l=1;else{if(!i.classList.contains("wte-down"))return;l=-1}let{extraServices:d,services:g,cartTotal:p,cart:u}=e.getState(),m=l>0?1:0;if(d[o]&&(m=l>0?d[o][n]?+d[o][n].count+1:1:d[o][n]?+d[o][n].count-1:0),m<0)return;let f=g[o]||{},h=null!==(a=f?.meta?.wte_services)&&void 0!==a?a:{},b=null!==(r=h?.service_required)&&void 0!==r&&r;if(0===m&&b&&alert(wteL10n?.l10n?.invalidCartExtraReq?.replace("%s",f.title.rendered)),b&&("default"===h.service_type||"select"===h.field_type)&&m<1)return;let v=0,w="",k="unit";h?.service_type&&("custom"===h.service_type?(w=h.options[n],v=+h.prices[n],k=h.service_unit):(w=f.title.rendered,v=+h.service_cost,k=h.service_unit)),c={...d[o],[n]:{count:m,unitPrice:v,label:w,per:k}};let _={...d,[o]:c},T=0,y=[];for(let e in _){let t=_[e];for(let e in t){let a=t[e];T+=+a.count*+a.unitPrice,+a.count>0&&(y=[...y,{extra_service:a.label,qty:a.count,price:+a.unitPrice}])}}u={...u,extraServices:y},e.dispatch({type:"UPDATE_STORE",data:{extraServices:_,cartTotal:{...p,services:T},cart:u}})};wteL10n.util.on("change",".wte-booking-es-select",(function(t){let a=this,r=a.dataset.info;r=r&&JSON.parse(r);let{extraServices:i,services:s}=e.getState(),{serviceID:o,option:n}=r,{options:c,service_unit:l,prices:d}=s[o].meta.wte_services,g={};g={...i,[o]:{[a.value]:{count:0,label:c[a.value],per:l,unitPrice:d[a.value]}}},e.dispatch({type:"UPDATE_STORE",data:{extraServices:g}})})),wteL10n.util.on("click",".wte-booking-es-counter .wte-up",r),wteL10n.util.on("click",".wte-booking-es-counter .wte-down",r)}),this._store=e(),this.unsubscriber=this._store.subscribe((()=>{!this._store.getState().loading&&this._store.getState().trip&&(console.info("Initialize Booking Process",this._store.getState()),this.init())})),this._store.subscribe((()=>{this.updateSelectedTime(),this.updateSummary(),this.updatePackageTabContent()})),this._store.dispatch(((e,t)=>{const a=setInterval((()=>{if(window.wtePreFetch?.data){const{trip:t,tripPackages:r,pricingCategories:i}=window.wtePreFetch.data;e({type:"UPDATE_STORE",data:{loading:!1,trip:t,tripPackagesIds:t.packages_ids||[],tripPackages:lodash.keyBy(r,"id"),pricingCategories:lodash.keyBy(i,"id"),primaryCategory:Object.values(i).find((e=>e["is-primary"]))}}),clearInterval(a)}}),400)})),this.priceFormat=function(e){return wteL10n.priceFormat(e)},this.cart={},this.currentTab=0,this.tabController={},this.timeformat="h:mm A",this.timeformatter=e=>(wteL10n.format.datetime.timezone,moment(e).format(this.timeformat)),this.addToCart=async()=>{const{wpxhr:{root:e},tripID:t,_nonces:{addtocart:a}}=wteL10n;let{cart:r,selectedPackage:i,selectedDate:s,selectedTime:o,travelerRecord:n,cartTotal:c,packageCategories:l,groupPricings:d,timeRange:g,trip:p,extraServices:u,services:m}=this._store.getState();if(""!=p.min_pax&&+p.min_pax>r.traveler)throw Error(wteL10n?.l10n?.invalidCartTraveler?.replace("%s",p.min_pax));if(!r?.traveler||r.traveler<1)throw Error(wteL10n?.l10n?.invalidCartTraveler?.replace("%s",1));if(Object.keys(p.trip_extras).length>0&&Object.keys(p.trip_extra_services).length>0){let e={},t=!1,a=[],r={};if(Object.keys(m).length>0&&Object.values(m).forEach((function(i){var s,o;e=null!==(s=i?.meta?.wte_services)&&void 0!==s?s:{},r=i?.id,t=null!==(o=e?.service_required)&&void 0!==o&&o,t&&(a[r]=t)})),a=Object.keys(a).reduce(((e,t)=>(a[t]&&(e[t]=a[t]),e)),{}),Object.keys(a).length>0)for(const e in a){if(!u.hasOwnProperty(e))throw new Error(wteL10n?.l10n?.invalidCartExtra);const t=u[e];if(!Object.values(t).some((e=>e.count>0)))throw new Error(wteL10n?.l10n?.invalidCartExtra)}}wteL10n.format.datetime.GMTOffset;let f=i,h=s.format("YYYY-MM-DD"),b=n,v={};for(let e in b){let t=b[e];if(t<1)continue;let a=l[e],r={pax:t,salePrice:a?.salePrice?+a.salePrice:0,groupDiscountPrice:0,cost:+a.price};if(a.enabledSale&&(r.cost=a.salePrice),a.enabledGroupDiscount&&d&&d[e])for(let i of d[e]){if(i.to.length<1){r.cost=i.price.length>0?+i.price:+a.price;break}if(t>=+i.from&&t<=+i.to){r.cost=i.price.length>0?+i.price:+a.price;break}}r.categoryInfo=a,v={...v,[e]:r}}let w=o.get()?o.format("YYYY-MM-DDTHH:mm"):"";c=Object.values(c).reduce((function(){return+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)+ +(arguments.length>1?arguments[1]:void 0)})),r={...r,nonce:a,tripID:t,packageID:f,tripDate:h,tripTime:w,timeRange:g?.map((e=>e.format("YYYY-MM-DDTHH:mm")))||[],travelers:b,cartTotal:c,pricingOptions:v,cversion:wteL10n?.cart_version||"2.0"};const k=await fetch(`${e}?action=wte_add_trip_to_cart&cart_version=${r.cversion}&_nonce=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!k.ok)throw new Error(k.statusText);try{const e=await k.json();if(e.success)return window.location.href=e.data.redirect,e;if(e.data&&e.data[0])throw Error(e.data[0])}catch(e){throw Error(e.message)}}}init(){this.unsubscriber(),this.loadTemplates(),this.initTabController(),this.initCalendar(),this.eventListeners(),this.bookingProcessFlowControl()}initTabController(){var e=this;let t=this.bookingform.querySelectorAll(".wte-process-nav-item"),a=this.bookingform.querySelectorAll(".wte-process-tab-item");var r;this.tabController={tabCount:t?.length,navigators:t,activeTab:"wte-booking-datetime",activeClass:"active",completedClass:"finish",nextBtn:"#wteProcessNext",prevBtn:"#wteProcessPrev",toggleNextBtn:function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const a=document.querySelector(e.nextBtn);a&&(a.disabled=t)},finalAction:(r=this,async function(){let e=document.querySelector(r.tabController.nextBtn);e&&(e.disabled=!0,e.classList.add("btn-loading"));try{const t=await r.addToCart();if(!t.success)throw Error(t.message);e.disabled=!0,e.classList.toggle("btn-loading",!0)}catch(t){e.disabled=!1,e.classList.toggle("btn-loading",!1),alert(t.message)}}),validToNextProcess:(e=>function(){let t=e.tabController,a=document.querySelector(t.nextBtn);switch(t.activeTab){case"wte-booking-datetime":const{selectedDate:t,availableTimes:r,selectedTime:i}=e._store.getState();return t&&t?.get()&&(Object.keys(r).length<1||Object.keys(r).length&&i?.get());case"wte-booking-packages":const{cart:s}=e._store.getState();return s?.traveler&&s.traveler>0?(a.disabled=!1,!0):(alert(wteL10n?.l10n?.invalidCartTraveler?.replace("%s",1)),!1);default:return!0}})(this),switchBtnText:function(){let e=WTEBooking.tabController,t=document.querySelector(e.nextBtn);e.getActiveTabIndex()>=e.tabCount-1?t.textContent=t.dataset.labelCheckout||"Add to Cart":t.textContent=t.dataset.labelDefault||"Continue"},getActiveTabIndex:function(){let e=document.getElementById(this.activeTab);return Array.prototype.indexOf.call(a,e)},handleProcessBtnClick:function(e){let t=WTEBooking.tabController;if(this.matches(t.prevBtn))t.activeTab=a[t.getActiveTabIndex()-1].id;else if(this.matches(t.nextBtn)){let e=t.getActiveTabIndex()+1;if(e>=t.tabCount)t.finalAction();else{let r=a[e].id;t.validToNextProcess()&&(t.activeTab=r)}}t.switchBtnText(),t.getActiveTabIndex()>0?document.querySelector(t.prevBtn).style.removeProperty("display"):document.querySelector(t.prevBtn).style.display="none",t.showActiveTab()},init:function(){let e=this;e.showActiveTab();let t=+e.getActiveTabIndex();t<1&&(document.querySelector(e.prevBtn).style.display="none"),document.querySelector(".wte-process-nav-list").style.setProperty("--step-bar-width",(t+1)/3*100+"%"),wteL10n.util.on("click",e.nextBtn,e.handleProcessBtnClick),wteL10n.util.on("click",e.prevBtn,e.handleProcessBtnClick)},showActiveTab:function(){let e=this,t=+e.getActiveTabIndex();if(t<0)t=0;else if(t>=e.tabCount)t=e.tabCount-1;else{document.querySelector(".wte-process-nav-list").style.setProperty("--step-bar-width",(t+1)/3*100+"%");for(let r in Array.from(e.navigators)){let i=e.navigators[r];if(r<=t){if(r<t?i.classList.add(e.completedClass):i.classList.add(e.activeClass),r==t){for(let e in Array.from(a))a[e].style.removeProperty("display");document.querySelector("a"===i.tagName.toLowerCase()?i.hash:i.dataset.target).style.display="block"}}else i.classList.remove(e.activeClass,e.completedClass)}}}},this.tabController.init()}getJSONData(){return{trip:this.trip,tripPackages:this.tripPackages,availablePackages:this.availablePackages,selectedPackage:this.selectedPackage,packageCategories:this.getPackageCategories(this.selectedPackage),travelerRecord:this.travelerRecord,groupPricings:this.selectedPackage?this.tripPackages[this.selectedPackage]["group-pricing"]:{},formatPrice:this.formatPrice,selectedDate:this.selectedDate,cartTotal:this.calculateCartTotal(),selectedTime:this.selectedTime,availableTimes:this.availableTimes,extraServices:this.extraServices}}loadTemplates(){document.getElementById("wte-booking-datetime-content").innerHTML=this.datetimeTemplate(this._store.getState()),document.getElementById("wte-booking-packages-content").innerHTML=wp.template("wte-booking-packages")(this._store.getState()),document.getElementById("wte-booking-summary").innerHTML=wp.template("wte-booking-summary")(this._store.getState()),document.dispatchEvent(new Event("wteLoadBookingTemplates"))}calculateCartTotal(){let e=this.travelerRecord,t=0;for(let r in e){let i=e[r],s=this.getPackageCategories(this.selectedPackage)[r],o=s.enabledSale?+s.salePrice:+s.price,n=this.selectedPackage?this.tripPackages[this.selectedPackage]["group-pricing"]:{};if(Object.keys(n).length>0&&n[r]){var a=n[r];for(let e of a){if(e.to.length<1){o=e.price||o;break}if(+i>=+e.from&&+i<=+e.to){o=e.price;break}}}t+=o*+i}return t}eventListeners(){var e;wteL10n.util.on("click",".wte-package-select-btn",(e=this,function(t){let a=this.dataset.packageId,{tripPackages:r}=e._store.getState();const i=e.getDefaultCart(a);e._store.dispatch({type:"UPDATE_STORE",data:{selectedPackage:a,packageCategories:e.getPackageCategories(a),groupPricings:a?r[a]["group-pricing"]:{},...i}})}));const t=e=>function(t){let a=this,r=0;if(a.classList.contains("wte-up"))r=1;else{if(!a.classList.contains("wte-down"))return;r=-1}let{travelerRecord:i,cart:s,cartTotal:o,packageCategories:n,tripPackages:c,selectedPackage:l,trip:d,selectedTime:g,selectedDate:p,parentDateConfig:u}=e._store.getState(),m={...s},f={...i},h=a.parentElement.dataset.info;h=h&&JSON.parse(h);const b=h.catID;if(f[b]<1&&r<0)return;let v=0;if(r>0?(v=f[b]?+f[b]+1:1,m.traveler=m?.traveler?+m.traveler+1:1):(v=f[b]&&f[b]>=1?+f[b]-1:0,m.traveler=m?.traveler?+m.traveler-1:0),v<0)return;let w=n[b].minPax;w&&v<w&&(m.traveler=m.traveler-r*(1-w),v=r<0?0:w);let k=n[b].maxPax;if(k&&v>k&&(m.traveler=m.traveler-1,v=k),""!=d.max_pax&&+d.max_pax<m.traveler)return void alert(wteL10n?.l10n?.availableSeatsExceed?.replace("%s",d.max_pax));let _=-1;if(g.get()){let e=g.format("YYYY-MM-DD-HH-mm-ss").split("-");e[1]=e[1]-1,_=.001*new Date(Date.UTC(...e)).getTime()}else if(p?.get()){let e=p.format("YYYY-MM-DD").split("-");e[1]=e[1]-1,_=.001*new Date(Date.UTC(...e)).getTime()}_+=parseInt(l);const T=new Date(p._time),y=`${T.getFullYear()}-${String(T.getMonth()+1).padStart(2,"0")}-${String(T.getDate()).padStart(2,"0")}`;let P=e.getPackagesDates();if(u=P[y]&&P[y][l]||null,u&&d["booked-seats"]&&d["booked-seats"][_]&&parseInt(d["booked-seats"][_]?.booked)){const e=u&&u?._seats?parseInt(u._seats)-parseInt(d["booked-seats"][_].booked):-1;if(""!==u._seats&&e>-1&&e<m.traveler)return void alert(wteL10n?.l10n?.availableSeatsExceed?.replace("%s",e))}else if(u&&parseInt(u._seats)<+m.traveler)return void alert(wteL10n?.l10n?.availableSeatsExceed?.replace("%s",u._seats));f={...f,[b]:v};let C=0;for(let e in f){let t=f[e],a=n[e],r=a.enabledSale?+a.salePrice:+a.price,i=c[l]["group-pricing"]||{};if(a.enabledGroupDiscount&&Object.keys(i).length>0&&i[e]){var D=i[e];for(let e of D){if(e.to.length<1){r=e.price||r;break}if(+t>=+e.from&&+t<=+e.to){r=e.price;break}}}C+="per-group"===a.pricingType?t&&+r||0:r*+t}e._store.dispatch({type:"UPDATE_STORE",data:{travelerRecord:f,cart:m,cartTotal:{...o,travelers:C}}})};wteL10n.util.on("click",".wte-booking-pc-counter .wte-down",t(this)),wteL10n.util.on("click",".wte-booking-pc-counter .wte-up",t(this)),wteL10n.util.on("click",".wte-time-select-btn",(e=>function(t){let a=this.dataset.time,r=this.dataset.packageId.split(",");const[i,s]=a.split(":");let{tripPackages:o}=e._store.getState();if(e?.tabController?.nextBtn){const t=document.querySelector(e.tabController.nextBtn);t&&(t.disabled=!1)}if(a){const t=r[0],a=e.getDefaultCart(t);e._store.dispatch({type:"UPDATE_STORE",data:{selectedPackage:t,packageCategories:e.getPackageCategories(t),groupPricings:t?o[t]["group-pricing"]:{},selectedTime:wteL10n.dateFormat(new Date(+i)),timeRange:[wteL10n.dateFormat(new Date(+i)),wteL10n.dateFormat(new Date(+s))],availablePackages:r.map((e=>o[e])),...a}})}})(this))}getPackageCategories(e){if(!e)return{};let{tripPackages:t}=this._store.getState();return t[e]["package-categories"]}clear(){this._store.dispatch({type:"UPDATE_STORE",data:{selectedDate:wteL10n.dateFormat(null),selectedTime:wteL10n.dateFormat(null),selectedPackage:null,defaultDateFormat:"YYYY-MM-DD",packageCategories:{},travelerRecord:{},cart:{}}})}updateSelectedTime(){document.getElementById("wte-booking-times-content").innerHTML=wp.template("wte-booking-times")(this._store.getState())}getDefaultCart(e){if(!e)return;let{tripPackages:t,trip:a}=this._store.getState();const r=this.getPackageCategories(e),i={};let s={traveler:0},o=0;const n=a?.primary_category;if(!r[n])return{cart:s,cartTotal:{travelers:o},travelerRecord:i};let c=r[n],l=n,d=c.enabledSale?+c.salePrice:+c.price,g=c.minPax?parseInt(c.minPax):0;i[l]=g;let p=t[e]["group-pricing"]||{};if(c.enabledGroupDiscount&&Object.keys(p).length>0&&p[l]){var u=p[l];for(let e of u){if(e.to.length<1){d=e.price||d;break}if(g>=+e.from&&g<=+e.to){d=e.price;break}}}return s.traveler=parseInt(s.traveler)+g,o+="per-group"===c.pricingType?g&&+d||0:d*g,{cart:s,cartTotal:{travelers:o},travelerRecord:i}}bookingProcessFlowControl(e){const t=this;e||this.bookingform.classList.add("wte-bp-flow");const a=document.getElementById("wte-booking-datetime"),r={dateChange:function(){if(a&&t.bookingform.classList.contains("wte-bp-flow")){const e=a.offsetHeight;let t=a.children;if(t[0]){let r=t[0].offsetHeight,i=function(){a.scrollTop<r-e&&(a.scrollTop=r-e>a.scrollTop?a.scrollTop+10:a.scrollTop,setTimeout(i))};i()}}}};r[e]&&r[e]()}initCalendar(){let e=this.getPackagesDates();const t=Object.values(e._nodates);delete e._nodates;let{tripPackages:a,trip:r,cart:i}=this._store.getState();console.debug({_dates:e});let s=e._minDate;delete e._minDate;let o={minDate:s,inline:!0,onChange:(t,i)=>{t[0].getTimezoneOffset(),t=new Date(t[0].getTime());let s=moment(t).format("YYYY-MM-DD");this.clear();let o=[];e[s]&&(o=Object.keys(e[s]).map((e=>a[e])));const n=Object.values(a).filter((e=>Object.values(e["package-dates"]).length<1));o=[...o,...n];let c=o.map((e=>e.id)),l=r?.packages_ids?.find((e=>c.indexOf(e)>-1))||o[0].id,d={};const g=this.getDefaultCart(l),p=e[s]&&e[s][l]||null;if(e[s])for(let[a,i]of Object.entries(e[s])){let e=i;if(!(e._times.length<1))for(let i in e._times){let s=e._times[i],o=s?.from?.split(":"),n=new Date(t);n.setHours(o[0]),n.setMinutes(o[1]);let c=s?.to?.split(":"),u=new Date(t);u.setHours(c[0]),u.setMinutes(c[1]);let m="_"+moment(n).format("HH-mm")+"_"+moment(u).format("HH-mm");if(d[m]){d[m].packages=[...d[m].packages,a];continue}let f=!0;const h=r["booked-seats"];let b=.001*n.getTime();if(b+=parseInt(l),h&&h[b]){f=!!h[b]?.booked&&+h[b]?.booked>0;let e=p?._seats&&h[b]?.booked?+p._seats-+h[b].booked:-1;f=!g?.cart?.traveler&&e>0&&e>g?.cart?.traveler}d[m]={from:n,to:u,packages:[a],formatter:this.timeformatter,isAvailable:f}}}const u=document.querySelector(this.tabController?.nextBtn);t&&Object.values(d).length<=0?u&&(u.disabled=!1):u&&(u.disabled=!0),this._store.dispatch({type:"UPDATE_STORE",data:{...g,parentDateConfig:p,selectedDate:wteL10n.dateFormat(t),availablePackages:o,selectedPackage:l,availableTimes:d,packageCategories:this.getPackageCategories(l),groupPricings:l?a[l]["group-pricing"]:{}}}),this.bookingProcessFlowControl("dateChange")},disable:[e=>!1],onReady:function(){const e=document.getElementById("open-booking-modal");if(e&&(e.disabled=!1),window.location.search?.split("&").indexOf("action=fsd_booking")>-1){let t=window.location.search?.replace("?","").split("&").map((e=>e.split("="))).find((e=>"date"===e[0]));e.click(),(arguments.length<=2?void 0:arguments[2])?.setDate(t,!0)}document.dispatchEvent(new Event("bookingCalendarReady"))}};o.disable=[(e=>{let a=s;return r=>!(!s||t.length>0&&moment(r).isSameOrAfter(a)||e[moment(r).format("YYYY-MM-DD")])})({...e})],flatpickr("#wte-booking-date-calendar",o)}formatPrice(e){const{currency:t,baseCurrency:a,currencySymbol:r,format:{number:i,price:s}}=wteL10n;let o={[a]:1};if("undefined"!=typeof wteCc&&wteCc?.code)for(let e in wteCc.code)o={...o,[wteCc.code[e]]:wteCc.rate[e]};return e*=+o[t],wteL10n.helpers.priceFormat(e,t,r,s,+i.decimal,i.decimalSeparator,i.thousandSeparator)}updateSummary(){document.getElementById("wte-booking-summary").innerHTML=wp.template("wte-booking-summary")(this._store.getState())}updatePackageTabContent(){document.getElementById("wte-booking-packages-content").innerHTML=wp.template("wte-booking-packages")(this._store.getState())}_dateToUTC(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("invalid date"!==(e=new Date(moment(e).tz("utc").toDate())).toString().toLowerCase()){let a=0,r=0;if(t){let e=t.split(":");a=+e[0],r=+e[1]}return new Date(Date.UTC(e.getUTCFullYear(),e.getMonth(),e.getDate(),a,r,0,0))}return e}_dateToTripTimeZone(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("invalid date"!==(e=new Date(e)).toString().toLowerCase()){if(e.setHours(0),e.setMinutes(0),e.setSeconds(0),t){let a=t.split(":");e.setHours(+a[0]),e.setMinutes(+a[1])}let a=`${moment(e).format("YYYY-MM-DDTHH:mm:ss")}${wteL10n.format.datetime.timezone}`;return new Date(a)}return e}getPackagesDates(){const{tripPackages:e,trip:t}=this._store.getState();let a={_nodates:[]},r=new Date;r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0),t.cut_off_time?.enabled&&(r=moment(r).add(t.cut_off_time.duration,t.cut_off_time.duration_unit).toDate());for(let i in e){let s=e[i]["package-dates"];if(s&&Object.values(s).length<1)a._nodates=[...a._nodates,i];else for(let e in s){let o=s[e],n=lodash.get(o,"dtstart",null);n=n.split("-");let c=new Date(Date.UTC(n[0],+n[1]-1,n[2],0,0,0,0)),l=c.getTime(),d=c;const g=lodash.get(o,"times",[]),p=lodash.get(o,"rrule",{}),u=!!lodash.get(o,"is_recurring",!1),m=lodash.get(o,"seats","");if(moment(d).isSameOrAfter(r)){let e=.001*l;if(e+=parseInt(i),""!==m&&t["booked-seats"]&&t["booked-seats"][+e]&&parseInt(t["booked-seats"][+e].booked)>=+m);else{let e=n.join("-");(!a._minDate||+a._minDate>moment(e).valueOf())&&(a._minDate=moment(e).valueOf()),a[e]={...a[e]?a[e]:{},[i]:{_times:g,_rrule:p,_isRecurring:u,_seats:m}}}}if(!u)continue;const{r_frequency:f,r_until:h,r_weekdays:b,r_months:v,r_count:w}=null!=p?p:{};let k={freq:f?rrule.RRule[f.toUpperCase()]:rrule.RRule.DAILY,dtstart:c};if(h){let e=this._dateToUTC(h);if(moment(r).isAfter(e))continue;k.until=e}switch(h||(k.count=w?+w:10),f){case"WEEKLY":k.byweekday=b&&Object.values(b).map((e=>rrule.RRule[e]))||[];break;case"MONTHLY":k.bymonth=v&&Object.keys(v).map((e=>+e))||[]}let _=new rrule.RRule(k).all(),T=0;for(let e in _){let s=_[e];if(moment(s.getTime()).isBefore(r))continue;0==e&&(T=k.dtstart.getTime()-s.getTime());let o=s.getTime()+T;if(o+=parseInt(i),""!==m&&t["booked-seats"]&&t["booked-seats"][o]&&parseInt(t["booked-seats"][o].booked)>=+m)continue;let n=moment.tz(moment(s).toISOString(),"UTC").format("YYYY-MM-DD"),c=moment(n).valueOf();(!a._minDate||+a._minDate>c)&&(a._minDate=c),a[n]={...a[n]?a[n]:{},[i]:{_times:g,_rrule:p,_isRecurring:u,_seats:m}}}}}return a._minDate||(a._minDate=r),a}};(()=>{const{wpapi:{root:e,versionString:a},tripID:r}=window.wtePreFetch,i=fetch(`${e}${a}trip/${r}?context=view`).then((e=>e.json())),s=fetch(`${e}${a}package-categories?per_page=100`).then((e=>e.json())),o=fetch(`${e}${a}packages/?trip_id=${r}&per_page=100`).then((e=>e.json()));Promise.all([i,s,o]).then((async e=>{const[t,a,r]=e;window.wtePreFetch.data={trip:t,tripPackages:r,pricingCategories:a}})),document.addEventListener("DOMContentLoaded",(function(){let e=document.getElementById("wte__booking");if(e){let a=new t(e);window.WTEBooking=a,jQuery.fn.fancybox&&jQuery("#open-booking-modal").fancybox({type:"inline",src:"#wte__booking",baseClass:"wte-fb-popup",touch:!1})}}))})()})()})();